
var PS_AU = ee.FeatureCollection(
 "projects/ee-stormwaterheatmap/assets/Puget_Sound_Assessment_Units_string")
var NHDPlus = ee.FeatureCollection("projects/ee-stormwaterheatmap/assets/NHDPlus_High_Resolution_Watershed_Dataset_string"
)

var HUC12 = ee.FeatureCollection(
   "projects/ee-stormwaterheatmap/assets/huc12")
/** 
 * This script generates average values for all predictors 
 * used in the stormwater heatmap 
 * It will be used as input to the credibility interval calculation script.
 */

// Import predicter images 
var predictors = require('users/stormwaterheatmap/coc_layers:scaled_predictors')
predictors = predictors.scaled_predictors

// make a reducer function to average predictors in a featureCollection 
function reduce_to_sheds(shedFc){
var reduced_predictors = predictors.reduceRegions({
    reducer: ee.Reducer.mean(),
    scale: 10,
    collection: shedFc, // featureCollection of watersheds 
}) 
//var feat_out = reduced_predictors.select({propertySelectors: ['huc12','devAge2','grass',
//'paved','pm25_na','sqrt_CO2_road','traffic'],retainGeometry:false})
return reduced_predictors
}

var feat_out = reduce_to_sheds(PS_AU)

Export.table.toCloudStorage({
  collection:feat_out, 
  bucket:'swhm-ee-exports/table-exports/predictors', fileFormat:'SHP', 
  fileNamePrefix: 'PSAU'
})

print(feat_out.first())