/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var census = ee.FeatureCollection("TIGER/2010/Blocks"),
    cityLimits = ee.FeatureCollection("users/stormwaterheatmap/tables/cityLimits"),
    PugetMask = ee.Image("projects/ee-swhm/assets/helper_layers/PugetSoundMask");
/***** End of imports. If edited, may not auto-convert in the playground. *****/

/* ---------------------------
* Author: Christian Nilsen, Geosyntec Consultants
* Email: cnilsen@geosyntec.com
* Date Created: 2021-07-16
*---------------------------

/**
 * Vectors
 *---------------------------
 */

var PugetSound = ee.FeatureCollection(
    "users/stormwaterheatmap/tables/PugetSound");
exports.PugetSound = PugetSound


var PugetSoundWA = ee.FeatureCollection(
    "projects/ee-swhm/assets/production_feature_collections/PugetSoundWA")
exports.PugetSoundWA = PugetSoundWA
exports.cityLimits = cityLimits.filterBounds(
    PugetSound)

exports.counties = ee.FeatureCollection(
        "TIGER/2018/Counties")
    .filterBounds(
        PugetSound)
exports.HUC12 = ee.FeatureCollection(
    "projects/ee-stormwaterheatmap/assets/huc12");
exports.HUC10 = ee.FeatureCollection(
        "USGS/WBD/2017/HUC10")
    .filterBounds(
        PugetSound);
exports.HUC08 = ee.FeatureCollection(
        "USGS/WBD/2017/HUC08")
    .filterBounds(
        PugetSound);
exports.NHDPlus = ee.FeatureCollection(
    "projects/ee-stormwaterheatmap/assets/NHDPlus_High_Resolution_Watershed_Dataset_string"
);
exports.PS_AU = ee.FeatureCollection(
    "projects/ee-stormwaterheatmap/assets/Puget_Sound_Assessment_Units_string"
)
exports.WRIA = ee.FeatureCollection(
        "users/stormwaterheatmap/WRIA_Bounds"
    )
    .filterBounds(PugetSound);
exports.MS4 = ee.FeatureCollection(
        "users/stormwaterheatmap/MS4_bounds"
    )
    .filterBounds(PugetSound)

/*---------------------------
Stormwaterheatmap Vector Assets
*/
exports.counties = ee.FeatureCollection(
  "TIGER/2018/Counties")
.filterBounds(
  PugetSound);
exports.traffic = ee.Image(0)
.blend(ee.Image(
  "users/cnilsen/trafficExport"))
.focal_max()
.selfMask()
//Watersheds
exports.PS_AU = ee.FeatureCollection(
'users/cnilsen/PS_AU')
/*---------------------------
Earth Engine Catalog Data
*/

exports.hrus = ee.Image("users/stormwaterheatmap/public/hrusJan2020Mode")


//exports.slope = slopeZone;




/*---------------------------
Stormwaterheatmap Image Assets
*/


exports.Age_of_Imperviousness = ee.Image("projects/ee-swhm/assets/production_layers/Age_of_Imperviousness")//.mask(PugetMask)
exports.Flow_Duration_Index = ee.Image("projects/ee-swhm/assets/production_layers/Flow_Duration_Index")//.mask(PugetMask)
exports.HSPF_Land_Cover_Type = ee.Image("projects/ee-swhm/assets/production_layers/HSPF_Land_Cover_Type")//.mask(PugetMask)
exports.Hydrologic_Response_Units = ee.Image("projects/ee-swhm/assets/production_layers/Hydrologic_Response_Units")//.mask(PugetMask)
exports.Imperviousness = ee.Image("projects/ee-swhm/assets/production_layers/Imperviousness")//.mask(PugetMask)
exports.Land_Cover = ee.Image("projects/ee-swhm/assets/production_layers/Land_Cover")//.mask(PugetMask)
exports.Land_Use = ee.Image("projects/ee-swhm/assets/production_layers/Land_Use")//.mask(PugetMask)
exports.Population_Density = ee.Image("projects/ee-swhm/assets/production_layers/Population_Density")//.mask(PugetMask)

var Precipitation_mm = ee.Image("projects/ee-swhm/assets/production_layers/Precipitation_mm")//.mask(PugetMask)

//need to mask out zeros for precip
Precipitation_mm = Precipitation_mm.selfMask() 
exports.Precipitation_mm = Precipitation_mm


exports.Runoff_mm = ee.Image("projects/ee-swhm/assets/production_layers/Runoff_mm").mask(PugetMask)
exports.Slope = ee.Image("projects/ee-swhm/assets/production_layers/Slope").mask(PugetMask)
exports.Slope_Categories = ee.Image("projects/ee-swhm/assets/production_layers/Slope_Categories").mask(PugetMask)
exports.Soils = ee.Image("projects/ee-swhm/assets/production_layers/Soils").mask(PugetMask)
exports.Traffic = ee.Image("projects/ee-swhm/assets/production_layers/Traffic").mask(PugetMask)



/** 
 * Cocs
 * / 
*/ 

var copper = ee.Image("projects/ee-swhm/assets/production_layers/Total_Copper_Concentration")
var p = ee.Image("projects/ee-swhm/assets/production_layers/Total_Phosphorus_Concentration")
var tkn = ee.Image("projects/ee-swhm/assets/production_layers/Total_Kjeldahl_Nitrogen_Concentration")
var tss = ee.Image("projects/ee-swhm/assets/production_layers/Total_Suspended_Solids_Concentration")
var zinc = ee.Image("projects/ee-swhm/assets/production_layers/Total_Zinc_Concentration")

function add_log_band(img){
  return img.addBands(img.log())
}

copper = add_log_band(copper).rename(['copper_concentration_ug_per_L', 'log_copper_concentration_ug_per_L']);
p     = add_log_band(p).rename(['p_concentration_ug_per_L', 'log_p_concentration_ug_per_L']);
tkn   = add_log_band(tkn).rename(['tkn_concentration_ug_per_L', 'log_tkn_concentration_ug_per_L']);
tss   = add_log_band(tss).rename(['tss_concentration_ug_per_L', 'log_tss_concentration_mg_per_L']);
zinc  = add_log_band(zinc).rename(['zinc_concentration_ug_per_L', 'log_zinc_concentration_ug_per_L']);

//convert tss Band 1 to mg/L 
tss = tss.select(0).addBands(
  tss.select(0).divide(1000).log().rename("log_tss_concentration_mg_per_L"))




exports.Total_Copper_Concentration = copper
exports.Total_Phosphorus_Concentration = p 
exports.Total_Kjeldahl_Nitrogen_Concentration = tkn  
exports.Total_Suspended_Solids_Concentration = tss
exports.Total_Zinc_Concentration = zinc

var psau_shed_img = ee.Image("projects/ee-stormwaterheatmap/assets/pasuv2")
    .select(0)
    .gt(0)
    .byte()
    .focal_max(1)
exports.psau_shed_img = psau_shed_img
