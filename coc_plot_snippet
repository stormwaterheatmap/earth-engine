/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var geometry = /* color: #d63000 */ee.Geometry.Point([-122.05868163496143, 47.53760459472781]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/

var data  = require('users/stormwaterheatmap/apps:data/data_dict_v4')
var Style = require('users/stormwaterheatmap/apps:Modules/Style')
var charts = require('users/stormwaterheatmap/apps:Modules/chart.js')

var helpers = require('users/stormwaterheatmap/apps:Modules/helpers')

var shed = data.vector_dict["Puget Sound Assessment Units"].filterBounds(geometry)
Map.addLayer(shed)

var stacked_cocs = 

function coc_mean_conc(layerObj, region, scale) {
  //text for loading whil calucations happen 
  var units = layerObj.units;
  var loading = 'loading...';
  var bigNum = ui.Label({
    value: loading,
    style: style.fonts.Body3
  });
  bigNum.style()
    .set({
      margin: 2,
      padding: 2,
      width: '80%',
      fontSize: '30px',
      fontFamily: ['Roboto', 'Helvetica Neue',
        'Arial', 'sans-serif'
      ],
      fontWeight: 500,
      //  border: '1px solid blue', 
      backgroundColor: style.colors.transparent,
      textAlign: 'right',
    });

  var title_value = layerObj.layer.name;


  var titleLabel = ui.Label({
    value: title_value,
    style: style.fonts.H4
  });
  titleLabel.style()
    .set({
      margin: 0,
      padding: 0,
      width: '80%',
      textAlign: 'right',
      //   border: '1px solid red'
    });
  units = ui.Label({
    value: units,
    style: style.fonts.Caption3
  });
  units.style()
    .set({
      textAlign: 'right',
      width: '80%',
    });

  var numPan = ui.Panel({
    layout: ui.Panel.Layout.flow('vertical'),
    style: {
      textAlign: 'right',
      padding: 2,
      margin: 2,
    }
  }); //height: '200px'}}); 
  numPan.add(titleLabel); //.add(infoLabel)
  numPan.add(bigNum);

  numPan.add(units);
  var infoLabel = ui.Label({
    style: style.fonts.Caption3
  });
  infoLabel.style()
    .set({
      margin: 0,
      padding: 2,
      fontSize: '10px',
      textAlign: 'right',
      //   border: '1px solid green',
      //width: '80%',
      color: style.colors.sDark,
    });
  var labelText = (
    'Scale of Analysis: ' + scale + ' sq.m/pixel' + /n/ + scale);
  var labelText2 = ui.Label({
    style: style.fonts.Caption3
  });
  labelText2.style()
    .set({
      //   margin: 0, //fontSize: '10px',
      //color:style.colors.sDark,
      margin: 2,
      padding: 2,
      textAlign: 'right',
      width: '80%',
      //      border: '1px solid pink', 
      fontSize: '10px',
    });
  labelText2.setValue('Source: ' + layerObj.sourceName);
  labelText2.setUrl(layerObj.sourceUrl);
  infoLabel.setValue(labelText);
  numPan //.add(infoLabel)
    .add(labelText2); //.add(labelText2)



  //if(reducerType == 'mean') {
  var reduced = ee.Number((layerObj.layer.eeObject.select(0))
    .reduceRegion({
      reducer: ee.Reducer.mean(),
      geometry: region,
      scale: scale,
      maxPixels: 100000,
      bestEffort: true
    })
    .get(layerObj.layer.eeObject.bandNames()
      .get(0)));
  reduced.evaluate(function (result) {
    // When the server returns the value, show it.
    bigNum.setValue(result.toPrecision(3));
  });
  //  
  return numPan;
}

var data = require('users/stormwaterheatmap/apps:data/data_dictionary.js')

print(data.cocs)

var concentration_objects = [
  'Total Copper Concentration',
  'Total Kjeldahl Nitrogen Concentration',
  'Total Phosphorus Concentration',
  'Total Suspended Solids Concentration',
  'Total Zinc Concentration']

var stacked = ee.Dictionary(data.cocs).select(concentration_objects) 
print(stacked)

var img = ee.Image.cat(
  data.cocs[concentration_objects[0]].layer.eeObject.select(0),
  data.cocs[concentration_objects[1]].layer.eeObject.select(0),
  data.cocs[concentration_objects[2]].layer.eeObject.select(0),
 // data.cocs[concentration_objects[3]].layer.eeObject.select(0),
  data.cocs[concentration_objects[4]].layer.eeObject.select(0)
  )


Map.addLayer(img)
var red = img.reduceRegion({
  reducer: ee.Reducer.mean(), 
  scale: 100, 
  geometry: geometry
})
print(red)
var chart = ui.Chart.image.regions(img, geometry, ee.Reducer.mean(), 100)
print(chart)

