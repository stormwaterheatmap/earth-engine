
var data = require('users/stormwaterheatmap/apps:Modules/datasets')
var drawButton = ui.Button({label: 'Draw a region',
  onClick: getDrawingTools})
var scaleSelect = ui.Slider(10,100,30,10)  

var layer_object = data.rasters["Age of Imperviousness"]
var img = layer_object.layer.eeObject
var drawingTools = Map.drawingTools();

drawingTools.setDrawModes(['point','polygon'])

var downloadLabel = ui.Label('Download',{shown:false})

var clearButton = (ui.Button({
  label: 'Clear Drawing', 
  onClick: clearDrawings
  }))
var title = ui.Label("Title Here",{fontWeight: "bold"})
var panel = ui.Panel({widgets: [title,drawButton,clearButton,downloadLabel], 
  style: {position: 'bottom-left'}
})

//add a starter image 
function map_init() {
 // Map.addLayer(img)
  Map.layers().reset()
  Map.widgets().reset([panel])
  downloadLabel.style().set({shown:false})
  Map.addLayer(img,layer_object.layer.visParams)
  print(Map.layers())

}
// Starter script: https://code.earthengine.google.com/?scriptPath=Examples:Demos/Classification

var getDrawingTools = function(){
  //activate drawing tools
  drawingTools.layers().reset()
  drawingTools.setShown(true).setDrawModes(['polygon','rectangle'])
  drawingTools.draw()
  }


// Only allow drawing points.

// Get the layers list.
var layers = drawingTools.layers();


// Use debounce to call the function at most every 100 milliseconds.
drawingTools.onEdit(ui.util.debounce(downloadImg, 500));
drawingTools.onDraw(ui.util.debounce(downloadImg, 500));
drawingTools.onSelect(ui.util.debounce(downloadImg, 500));



function downloadImg() {
  (Map.layers().reset())
  //get the current geometry 
  var boundary = drawingTools.layers().get(0).getEeObject()
  var clipedImg = img.clip(boundary)
  Map.addLayer(clipedImg)
  Map.centerObject(clipedImg)
  var url = clipedImg.getDownloadURL(
    {
    name: 'ee_image',
    scale: 300
 }
    
    );

  downloadLabel.style().set({shown:true})
  downloadLabel.setUrl(url
    )
}




function clearDrawings() {
  map_init()
drawingTools.layers().reset()
print(layers)
  
}

map_init() 

